<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Create a DataGrid with PHP MySQLi and jQuery EasyUI</title>
    <link rel="stylesheet" type="text/css" href="https://www.jeasyui.com/easyui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="https://www.jeasyui.com/easyui/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="https://www.jeasyui.com/easyui/themes/color.css">
    <link rel="stylesheet" type="text/css" href="https://www.jeasyui.com/easyui/demo/demo.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="https://www.jeasyui.com/easyui/jquery.easyui.min.js"></script>
</head>
<body>
    <h2>ข้อมูลพนักงานในระบบ</h2>
    <p>Click the buttons on datagrid toolbar to do crud actions.</p>
    <table id="dg" title="จัดการข้อมูลผู้ใช้งาน" class="easyui-datagrid" url="Admin_User_GetData.php" toolbar="#toolbar" pagination="true" rownumbers="true" fitColumns="true" singleSelect="true" style="width:100%;height:400px;">
  <thead>
   <tr>
    <th field="username" width="50">ชื่อผู้ใช้</th>
    <th field="passward" width="50">รหัสผ่าน </th>
    <th field="name" width="50">ชื่อ-นามสกุล</th>
    <th field="email" width="50">อีเมลล์</th>
    <th field="phone" width="50">โทรศัพท์</th>
   </tr>
  </thead>
 </table>
 <div id="toolbar">
  <div id="tb">
   <input id="term" placeholder="ค้นหา">
   <a href="javascript:void(0);" class="easyui-linkbutton" plain="true" onclick="doSearch()">ตกลง</a>
  </div>
  <div id="tb2" style="">
   <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="newUser()">เพิ่มพนักงาน</a>
   <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="editUser()">เเก้ไขพนักงาน</a>
   <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="destroyUser()">ลบพนักงาน</a>
  </div>
 </div>
 <div id="dlg" class="easyui-dialog" style="width:450px" data-options="closed:true,modal:true,border:'thin',buttons:'#dlg-buttons'">
  <form id="fm" method="post" novalidate style="margin:0;padding:20px 50px">
   <h3>ข้อมูลผู้ใช้งาน</h3>
   <div style="margin-bottom:10px">
    <input name="username" class="easyui-textbox" required="true" label="ชื่อผู้ใช้:" style="width:100%">
   </div>
   <div style="margin-bottom:10px">
    <input name="passward" class="easyui-textbox" required="true" label="รหัสผ่าน:" style="width:100%">
   </div>
   <div style="margin-bottom:10px">
    <input name="name" class="easyui-textbox" required="true" label="ชื่อ-สกุล:" style="width:100%">
   </div>
   <div style="margin-bottom:10px">
    <input name="email" class="easyui-textbox" required="true"  label="อีเมลล์:" style="width:100%">
   </div>
   <div style="margin-bottom:10px">
    <input name="phone" class="easyui-textbox" required="true" label="โทรศัพท์:" style="width:100%">
   </div>
  </form>
 </div>

 <div id="dlg-buttons">
  <a href="javascript:void(0);" class="easyui-linkbutton c6" iconCls="icon-ok" onclick="saveUser()" style="width:90px;">บันทึก</a>
  <a href="javascript:void(0);" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlg').dialog('close');" style="width:90px;">ยกเลิก</a>
 </div>

 <script type="text/javascript">
 function doSearch(){
  $('#dg').datagrid('load', {
   term: $('#term').val()
  });
 }
    
 var url;
 function newUser(){
  $('#dlg').dialog('open').dialog('center').dialog('setTitle','New User');
  $('#fm').form('clear');
  url = 'Admin_User_AddData.php';
 }
 function editUser(){
  var row = $('#dg').datagrid('getSelected');
  if (row){
   $('#dlg').dialog('open').dialog('center').dialog('setTitle','Edit User');
   $('#fm').form('load',row);
   url = 'Admin_User_EditData.php?id='+row.id;
  }
 }
 function saveUser(){
//   $('#fm').form('submit',{
//    url: url,
//    onSubmit: function(){
//     return $(this).form('validate');
$('#fm').form('submit',{
        url: 'Admin_User_AddData.php', //added quotes.
        onSubmit:function(){
            return $(this).form('enableValidation').form('validate');
   },
   success: function(response){
    var respData = $.parseJSON(response);
    if(respData.status == 0){
     $.messager.show({
      title: 'Error',
      msg: respData.msg
     });
    }else{
     $('#dlg').dialog('close');
     $('#dg').datagrid('reload');
    }
   }
  });
 }
 function destroyUser(){
  var row = $('#dg').datagrid('getSelected');
  if (row){
   $.messager.confirm('Confirm','Are you sure you want to delete this user?',function(r){
    if (r){
     $.post('Admin_user_deleteData.php', {id:row.id}, function(response){
      if(response.status == 1){
       $('#dg').datagrid('reload');
      }else{
       $.messager.show({
        title: 'Error',
        msg: respData.msg
       });
      }
     },'json');
    }
   });
  }
 }
 </script>
</body>
</html>